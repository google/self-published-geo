<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
    <!ENTITY rfc1035 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1035.xml">
    <!ENTITY rfc2119 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
    <!ENTITY rfc2616 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2616.xml">
    <!ENTITY rfc2818 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2818.xml">
    <!ENTITY rfc3629 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3629.xml">
    <!ENTITY rfc4180 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4180.xml">
    <!ENTITY rfc4291 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4291.xml">
    <!ENTITY rfc4408 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4408.xml">
    <!ENTITY rfc4632 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4632.xml">
    <!ENTITY rfc5952 PUBLIC ""
      "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5952.xml">
]>

<rfc category="exp"
     ipr="trust200902"
     docName="draft-self-published-geo-00.txt">

<?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>

<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes"?>
<?rfc iprnotified="no" ?>
<?rfc strict="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

  <front>
    <title>Self-published IP Geolocation Data</title>

    <author initials="E." surname="Kline" fullname="Erik Kline">
      <organization>Google Inc.</organization>
      <address>
        <postal>
          <street>Roppongi 6-10-1, 26th Floor</street>
          <city>Minato</city>
          <region>Tokyo</region>
          <code>106-6126</code>
          <country>JP</country>
        </postal>

        <phone>+81 03 6384 9000</phone>

        <email>ek@google.com</email>
      </address>
    </author>

    <author initials="K." surname="Duleba" fullname="Krzysztof Duleba">
      <organization>Google Inc.</organization>
    </author>

    <date/>

    <abstract>
      <t>
This document records a format whereby a network operator can publish a
mapping of IP address ranges to simplified geolocation information,
colloquially termed a geolocation "feed".  Consumers can poll and parse
these feeds to update or merge with other geolocation data sources and
procedures.
      </t>
      <t>
Some technical organizations operating networks that move from one meeting
location to the next have already experimentally published small geolocation
feeds.  At least one consumer (Google) has incorporated these ad hoc feeds
into a geolocation data pipeline.
      </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <section title="Motivation">
        <t>
TODO(ek).
        </t>
      </section>

      <section title="Requirements notation">
        <t>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in <xref target="RFC2119"/>.
        </t>
      </section>
    </section>

    <section title="Self-published IP geolocation feeds">
      <t>
TODO(ek).
      </t>

      <section title="Specification">
        <t>
For operational simplicity, every feed should contain data about all IP
addresses the provider wants to publish.  Alternatives, like publishing
only entries for IP addresses whose geolocation data has changed or differ
from current observed geolocation behavior "at large", are likely to be too
operationally complex.
        </t>

        <t>
Feeds MUST use UTF-8 <xref target="RFC3629"/> character encoding.
Text after a '#' character is treated as a comment only and ignored.
Blank lines are similarly ignored.
        </t>

        <t>
Feeds MUST be in comma separated values format as described in
<xref target="RFC4180"/>.  Each feed entry is a text line of the form:
          <figure>
            <artwork>
        IP_address_or_cidr,country,region,city,postal_code
            </artwork>
          </figure>
        </t>

        <t>
IP address fields are mandatory, all others are optional (can be empty),
though the requisite minimum number of commas SHOULD be present.
        </t>

        <section title="Geolocation feed individual entry fields">
          <section title="IP address">
            <t>
Mandatory.  Each IP address field MUST be either a single IP address or an
IP prefix in CIDR notation in conformance with
<eref target="http://tools.ietf.org/html/rfc4632#section-3.1">section 3.1</eref>
of <xref target="RFC4632"/> for IPv4 or
<eref target="http://tools.ietf.org/html/rfc4291#section-2.3">section 2.3</eref>
of <xref target="RFC4291"/> for IPv6.
            </t>
            <t>
Examples include "192.0.2.1" and "192.0.2.0/24" for IPv4 and "2001:db8::1"
and "2001:db8::/32" for IPv6.
            </t>
          </section>

          <section title="Country">
            <t>
Optional.  The country field SHOULD be a 2 letter ISO country code conforming
to ISO 3166-1 alpha 2 <xref target="ISO.3166.1"/>.  Parsers should treat this
field case-insensitively.  Empty country fields or a country identifier of "ZZ"
indicate unassigned reserved IPs for which other existing geolocation
information can, from the perspective of the publisher, safely be discarded.
            </t>
            <t>
Examples include "US" for the United States, "JP" for Japan, and "PL" for
Poland.
            </t>
          </section>

          <section title="Region">
            <t>
Optional.  The region field should be a ISO region code conforming to
ISO 3166-2 <xref target="ISO.3166.2"/>.  Parsers should treat this field
case-insensitively.
            </t>
            <t>
Examples include "ID-RI" for the Riau province of Indonesia and "NG-RI" for
the Rivers province in Nigeria.
            </t>
          </section>

          <section title="City">
            <t>
Optional.  The city field should be free text, excluding comma (',').
            </t>
            <t>
Examples include "Dublin", "New York", and "São Paulo", specifically
"S" followed by 0xc3, 0xa3, and "a Paulo".
            </t>
          </section>

          <section title="Postal code">
            <t>
Optional.  The postal code field should be free text, excluding comma (',').
            </t>
            <t>
Examples include "106-6126" (in Minato ward, Tokyo, Japan).
            </t>
          </section>
        </section>

        <section title="Parsing and matching">
          <t>
Entries which fail to parse, either in part or in full, SHOULD be discarded.
It is RECOMMENDED that they also be logged for further administrative review.
          </t>

          <t>
When parsing and matching, consumers MUST NOT attempt to use simple string
matching or regular expressions but instead MUST parse IP address and CIDR
string representations into IP prefixes and perform set membership tests.
While publishers SHOULD follow <xref target="RFC5952"/> style for IPv6
addresses, consumers MUST nevertheless accept all valid string representations.
          </t>

          <t>
Multiple entries which constitute nested prefixes are permitted.  Consumers
SHOULD consider the entry with the longest matching prefix (i.e. the
"most specific") to be the best matching entry for any given IP address.
          </t>

          <t>
TODO(ek): exact duplicate entries are erroneous, and consumer implementations MAY
discard or overwrite prior duplicate entries with subsequent data.  Publishers
MUST NOT rely upon any implementation-dependent behavior and instead SHOULD
take measures to ensure one and only one entry per prefix.
          </t>
        </section>
      </section>

      <section title="Examples">
        <t>
Example entries using different IP address formats and describing locations
at country, region, city and postal code granularity level, respectively:
          <figure>
            <artwork>
    192.0.2.0/25,US,US-AL,,
    192.0.2.5,US,US-AL,Alabaster,
    192.0.2.128/25,PL,PL-MZ,,02-784
    2001:db8:cafe::/48,PL,PL-MZ,,02-784
            </artwork>
          </figure>
        </t>

        <t>
Experimentally, RIPE has published geolocation information for their meeting
network prefixes, which change location in accordance with each new meeting.
<xref target="RIPE_NCC_GEO"/> at the time of writing contains:
          <figure>
            <artwork>
    193.0.24.0/21,IE,IE-D,Dublin,
    2001:67c:64::/48,IE,IE-D,Dublin,
            </artwork>
          </figure>
        </t>

        <t>
Similarly, ICANN has published geolocation information for their portable
meeting network prefixes.  <xref target="ICANN_GEO"/> at the time of writing
contains:
          <figure>
            <artwork>
    199.91.192.0/21,US,US-CA,Los Angeles,
    2620:f:8000::/48,US,US-CA,Los Angeles,
            </artwork>
          </figure>
        </t>
      </section>
    </section>

    <section title="Finding self-published IP geolocation feeds">
      <t>
TODO(ek).
      </t>
      <t>
The integrity of published information SHOULD be protected by securing the
means of publication, for example by using HTTP over TLS
<xref target="RFC2818"/>.  Whenever possible, consumers SHOULD prefer
retrieving geolocation feeds in a manner that guarantees integrity of the feed.
      </t>
      <section title="Ad hoc 'well known' URIs">
        <t>
TODO(ek).
        </t>
      </section>

      <section title="Publishing URIs in whois">
        <t>
TODO(ek).
        </t>
      </section>

      <section title="Using 'reverse' DNS">
        <t>
TODO(ek): document crazy _geo.4.3.2.1.in-addr.arpa TXT record format that
basically returns "v=1 https://example.net/ipgeo/v1.csv".  Also: can ask the
root of the zone in the SOA.
        </t>
      </section>
    </section>

    <section title="Consuming self-published IP geolocation feeds">
      <section title="Acceptable use implied">
        <t>
This proposal does not incorporate a mechanism to communicate acceptable
use policies for self-published data.  Publication itself is inferred as
a desire by the publisher for the data to be usefully consumed, similar
to the publication of information like hostnames, cryptographic keys, and
SPF records <xref target="RFC4408"/> in the DNS.
        </t>
      </section>

      <section title="Trust and verification">
        <t>
Consumers of self-published IP geolocation feeds SHOULD perform some form
of verification that the publisher is in fact authoritative for the
addresses in the feed.  The actual means of verification is dependent
upon the way in which the feed is discovered.  Ad hoc shared URIs, for example,
will likely require an ad hoc verification process.  Automated means of feed
discovery SHOULD have an accompanying automated means of verification.
        </t>
        <t>
A consumer MUST only trust geolocation information for IP addresses or ranges
for which the publisher has been verified as administratively authoritative.
All other geolocation feed entries MUST be ignored and SHOULD be logged for
further administrative review.
        </t>
      </section>

      <section title="Refreshing feed information">
        <t>
As a publisher can change geolocation data at any time and without
notification consumers SHOULD implement mechanisms to periodically refresh
local copies of feed data.  If the feed discovery mechanism offers hints
about data validity time (e.g. the TTL field of the DNS Resource Record which
identified a feed (section 3.2.1 of <xref target="RFC1035"/>)), then the given
feed SHOULD be refreshed before the expiration of this validity timer.
        </t>
        <t>
For feeds available via HTTPS (or HTTP), the publisher MAY communicate
refresh timing information by means of the standard HTTP expiration model
(<eref target="http://tools.ietf.org/html/rfc2616#section-13.2">section
13.2</eref> of <xref target="RFC2616"/>).  Specifically, publishers can
include either an
<eref target="http://tools.ietf.org/html/rfc2616#section-14.21">Expires
header</eref> or a
<eref target="http://tools.ietf.org/html/rfc2616#section-14.9">Cache-Control
header</eref> specifying the max-age.  Where practical, consumers SHOULD
refresh feed information before the expiry time is reached.
        </t>
        <t>
In the absence of any other refresh timing information it is recommended that
consumers SHOULD refresh feeds no less often than weekly.
        </t>
      </section>
    </section>

    <section title="Security Considerations">
      <t>
As there is no true security in the obscurity of the location of any given
IP address, self-publication of this data fundamentally opens no new attack
vectors.  Self-published data merely increases the ease with which such
location data might be exploited.
      </t>
    </section>

    <section title="Acknowledgements">
      <t>
The authors would like to express their gratitude to reviewers and early
implementers, including but not limited to Richard L. Barnes,
Marco Hogewoning, Menno Schepers, and Bjoern A. Zeeb.
      </t>
    </section>
  </middle>

  <back>
      <references title="Normative References">
&rfc2119;

&rfc2616;

&rfc3629;

&rfc4180;

&rfc4291;

&rfc4632;

<reference
 anchor="ISO.3166.1"
 target="http://www.iso.org/iso/home/standards/country_codes/iso-3166-1_decoding_table.htm">
  <front>
    <title>ISO 3166-1 decoding table</title>
    <author fullname="ISO 3166 Maintenance agency">
      <organization abbrev="ISO">
International Organization for Standardization
      </organization>
    </author>
  </front>
</reference>

<reference
 anchor="ISO.3166.2"
 target="http://www.iso.org/iso/home/standards/country_codes.htm#2012_iso3166-2"
 >
  <front>
    <title>ISO 3166-2:2007</title>
    <author fullname="ISO 3166 Maintenance agency">
      <organization abbrev="ISO">
International Organization for Standardization
      </organization>
    </author>
  </front>
</reference>
      </references>

      <references title="Informative References">
&rfc1035;

&rfc2818;

&rfc4408;

&rfc5952;

<reference target="https://meetings.ripe.net/geo/google.csv"
           anchor="RIPE_NCC_GEO">
  <front>
    <title>RIPE NCC Meeting Geolocation Data</title>
    <author fullname="Menno Schepers" initials="M." surname="Schepers">
      <organization abbrev="RIPE NCC">
Réseaux IP Européens Network Coordination Centre
      </organization>
    </author>
  </front>
</reference>

<reference target="https://registration.icann.org/geo/google.csv"
           anchor="ICANN_GEO">
  <front>
    <title>ICANN Meeting Geolocation Data</title>
    <author>
      <organization abbrev="ICANN">
Internet Corporation For Assigned Names and Numbers
      </organization>
    </author>
  </front>
</reference>
      </references>
  </back>
</rfc>
